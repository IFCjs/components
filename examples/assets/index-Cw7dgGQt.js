var p=Object.defineProperty;var f=(a,n,e)=>n in a?p(a,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[n]=e;var t=(a,n,e)=>(f(a,typeof n!="symbol"?n+"":n,e),e);import{L as g,V as m,i as u}from"./index-chvdFvuw.js";import{i as _,D as l,j as v,k as c}from"./N8AO-Di6ad4Ys.js";import{S as b}from"./index-BzV5uveS.js";const h=class h extends _{constructor(e){super(e);t(this,"onDisposed",new l);t(this,"onBeforeUpdate",new l);t(this,"onAfterUpdate",new l);t(this,"snapDistance",.25);t(this,"previewElement");t(this,"_vertexPicker");t(this,"_lineMaterial",new g({color:"#DC2626",linewidth:2,depthTest:!1}));t(this,"list",[]);t(this,"world");t(this,"_visible",!0);t(this,"_enabled",!1);t(this,"_temp",{isDragging:!1,start:new m,end:new m,dimension:void 0});t(this,"create",e=>{const i=e instanceof u?e:void 0;if(this._enabled){if(!this._temp.isDragging){this.drawStart(i);return}this.endCreation()}});t(this,"onKeyDown",e=>{this.enabled&&e.key==="Escape"&&(this._temp.isDragging?this.cancelCreation():this.enabled=!1)});this.components.add(h.uuid,this),this._vertexPicker=new v(e,{previewElement:this.newEndpoint(),snapDistance:this.snapDistance})}get enabled(){return this._enabled}set enabled(e){e||this.cancelCreation(),this._enabled=e,this._vertexPicker.enabled=e}get visible(){return this._visible}set visible(e){this._visible=e;for(const i of this.list)i.visible=e}set color(e){this._lineMaterial.color=e}dispose(){this.setupEvents(!1),this.enabled=!1,this.previewElement&&this.previewElement.remove();for(const e of this.list)e.dispose();this._lineMaterial.dispose(),this.list=[],this._vertexPicker.dispose(),this.onDisposed.trigger(h.uuid),this.onDisposed.reset()}async update(e){this._enabled&&this._temp.isDragging&&this.drawInProcess()}createOnPoints(e,i){const s=this.drawDimension();s.startPoint=e,s.endPoint=i,s.createBoundingBox(),this.list.push(s)}delete(){if(!this.world)throw new Error("World is needed for Length Measurement!");if(!this._enabled||this.list.length===0)return;const e=this.getBoundingBoxes(),r=this.components.get(c).get(this.world).castRay(e);if(!r)return;const o=this.list.find(d=>d.boundingBox===r.object);if(o){const d=this.list.indexOf(o);this.list.splice(d,1),o.dispose()}}async deleteMeasurement(e){if(e){const i=this.list.indexOf(e);this.list.splice(i,1),e.dispose()}}async deleteAll(){for(const e of this.list)e.dispose();this.list=[]}cancelCreation(){var e;this._temp.dimension&&(this._temp.isDragging=!1,(e=this._temp.dimension)==null||e.dispose(),this._temp.dimension=void 0)}drawStart(e){if(!this.world)throw new Error("The length measurement needs a world to work!");const i=e?[e]:void 0,o=this.components.get(c).get(this.world).castRay(i),d=this._vertexPicker.get(this.world);o&&d&&(this._temp.isDragging=!0,this._temp.start=e?o.point:d)}drawInProcess(){if(!this.world)throw new Error("The length measurement needs a world to work!");if(!this.components.get(c).get(this.world).castRay())return;const r=this._vertexPicker.get(this.world);r&&(this._temp.end=r,this._temp.dimension||(this._temp.dimension=this.drawDimension()),this._temp.dimension.endPoint=this._temp.end)}endCreation(){this._temp.dimension&&(this._temp.dimension.createBoundingBox(),this.list.push(this._temp.dimension),this._temp.dimension=void 0,this._temp.isDragging=!1)}drawDimension(){if(!this.world)throw new Error("The length measurement needs a world to work!");return new b(this.components,this.world,{start:this._temp.start,end:this._temp.end,lineMaterial:this._lineMaterial,endpointElement:this.newEndpoint()})}newEndpoint(){const e=document.createElement("div");return e.className="w-2 h-2 bg-red-600 rounded-full",e}getBoundingBoxes(){return this.list.map(e=>e.boundingBox).filter(e=>e!==void 0)}setupEvents(e){if(!this.world)throw new Error("The length measurement needs a world to work!");if(!this.world.renderer)throw new Error("The world of the length measurement needs a renderer!");const s=this.world.renderer.three.domElement.parentElement;s&&(e?(s.addEventListener("click",this.create),window.addEventListener("keydown",this.onKeyDown)):(s.removeEventListener("click",this.create),window.removeEventListener("keydown",this.onKeyDown)))}};t(h,"uuid","2f9bcacf-18a9-4be6-a293-e898eae64ea1");let w=h;export{w as L};
