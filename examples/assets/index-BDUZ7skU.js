var m=Object.defineProperty;var p=(c,n,t)=>n in c?m(c,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[n]=t;var o=(c,n,t)=>(p(c,typeof n!="symbol"?n+"":n,t),t);import{X as f,U as w,aI as k,F as P}from"./index-DOCiYP8C.js";const l=class l extends f{constructor(t){super(t);o(this,"tools",[]);o(this,"name","CloudProcessor");o(this,"enabled",!0);o(this,"modelProcessed",new w);o(this,"checkInterval",5e3);o(this,"_models",[]);o(this,"_token");o(this,"_urls",{base:"https://dev.api.dev.platform.thatopen.com/v1/models/",tokenParam:"?accessToken="});this.components.tools.add(l.uuid,this)}get(){return this._models}get token(){if(!this._token)throw new Error("Auth token has not been initialized!");return this._token}set token(t){this._token=t}async update(){const{base:t,tokenParam:e}=this._urls,s=`${t}${e}${this.token}`,r=await(await fetch(s)).json();this._models=r.models}async upload(t){const e=await this.createModel(),s=e.uploadUrl,r=await(await fetch(t)).arrayBuffer();await fetch(s,{method:"PUT",body:r}),this.setupModelProcessEvent(e.model._id)}async delete(t){const{base:e,tokenParam:s}=this._urls,a=`${e}/${t}${s}${this.token}`;return(await fetch(a,{method:"DELETE"})).json()}async getModel(t){const{base:e,tokenParam:s}=this._urls,a=`${e}/${t}${s}${this.token}`;return(await fetch(a)).json()}setupModelProcessEvent(t){const e=setInterval(async()=>{const s=await this.getModel(t);if(s.model.status==="PROCESSED"){const{entries:a}=await k(s.downloadUrl),r=await a["model.frag"].arrayBuffer(),u=new Uint8Array(r),i=await this.components.tools.get(P).load(u),h=await a["properties.json"].json();i.setLocalProperties(h),await this.modelProcessed.trigger(i),clearInterval(e)}},this.checkInterval)}async createModel(){const{base:t,tokenParam:e}=this._urls,s=`${t}${e}${this.token}`;return(await fetch(s,{method:"POST"})).json()}};o(l,"uuid","6fe6c739-d518-47b8-8057-a22a6c96e722");let d=l;export{d as C};
