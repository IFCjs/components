var v=Object.defineProperty;var x=(a,r,e)=>r in a?v(a,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[r]=e;var s=(a,r,e)=>(x(a,typeof r!="symbol"?r+"":r,e),e);import{X as _,a1 as E,U as u,x as k,aB as y,a9 as F,w as I,p as g,a2 as H}from"./index-CizoHJPb.js";class w extends _{constructor(e,t,h){super(e);s(this,"name","FragmentTreeItem");s(this,"enabled",!0);s(this,"filter",{});s(this,"uiElement",new E);s(this,"onSelected",new u);s(this,"onHovered",new u);s(this,"visible",!0);s(this,"_children",[]);s(this,"_blockCheckbox",!1);const o=new k(e),l=new y(e,h),i=new F(e);i.label="",i.value=!0;const d=this.components.tools.get(I);i.onChange.add(async n=>{if(this.visible=n,this._blockCheckbox)return;if(Object.keys(this.filter).length===0)for(const c of this.children){const p=await t.find(c.filter);d.set(n,p)}else{const c=await t.find(this.filter);d.set(n,c)}for(const c of this.children)c.setCheckbox(n,!0)}),l.slots.titleRight.addChild(i),this.uiElement.set({main:o,tree:l,checkbox:i}),l.onClick.add(async n=>{if(n.target instanceof HTMLInputElement)return;const f=await t.find(this.filter);await this.onSelected.trigger({items:f,visible:this.visible})}),l.get().onmouseenter=async()=>{const n=await t.find(this.filter);await this.onHovered.trigger({items:n,visible:this.visible})}}get children(){return this._children}set children(e){this._children=e,e.forEach(t=>{const h=t.uiElement.get("tree");this.uiElement.get("tree").addChild(h)})}setCheckbox(e,t){this.visible=e,this._blockCheckbox=!0;const h=this.uiElement.get("checkbox");if(h.value=e,this._blockCheckbox=!1,t)for(const o of this.children)o.setCheckbox(e,!0)}async dispose(){await this.uiElement.dispose(),this.onSelected.reset(),this.onHovered.reset();for(const e of this.children)await e.dispose()}get(){return{name:this.name,filter:this.filter,children:this.children}}}class D extends _{constructor(e){super(e);s(this,"onDisposed",new u);s(this,"enabled",!0);s(this,"onSelected",new u);s(this,"onHovered",new u);s(this,"_title","Model Tree");s(this,"_tree");s(this,"uiElement",new E)}get(){if(!this._tree)throw new Error("Fragment tree not initialized yet!");return this._tree}init(){const e=this.components.tools.get(g),t=new w(this.components,e,"Model Tree");this._tree=t,this.components.uiEnabled&&this.setupUI(t)}async dispose(){this.onSelected.reset(),this.onHovered.reset(),this.uiElement.dispose(),this._tree&&await this._tree.dispose(),await this.onDisposed.trigger(),this.onDisposed.reset()}async update(e){if(!this._tree)return;const t=this.components.tools.get(g);this._tree.children.length&&(await this._tree.dispose(),this._tree=new w(this.components,t,this._title)),this._tree.children=this.regenerate(e)}setupUI(e){const t=new H(this.components),h=e.uiElement.get("tree");t.addChild(h),t.title="Model tree",this.components.ui.add(t),t.visible=!1;const o=new k(this.components);o.materialIcon="account_tree",o.tooltip="Model tree",o.onClick.add(()=>{t.visible=!t.visible}),this.uiElement.set({main:o,window:t})}regenerate(e,t={}){const o=this.components.tools.get(g).get(),l=[],i=e[0],d=o[i];if(!i||!d)return l;for(const n in d){const f=this.components.tools.get(g),c={...t,[i]:[n]},p=f.find(c);if(Object.keys(p).length>0){const C=i[0].toUpperCase()+i.slice(1),m=new w(this.components,f,`${C}: ${n}`);m.onHovered.add(b=>this.onHovered.trigger(b)),m.onSelected.add(b=>this.onSelected.trigger(b)),m.filter=c,l.push(m),m.children=this.regenerate(e.slice(1),c)}}return l}}export{D as F};
