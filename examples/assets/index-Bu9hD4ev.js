var k=Object.defineProperty;var A=(h,o,t)=>o in h?k(h,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[o]=t;var e=(h,o,t)=>(A(h,typeof o!="symbol"?o+"":o,t),t);import{X as p,a3 as g,U as w,a1 as u,a_ as l,x as d,a2 as T,at as V,ae as y,T as C}from"./index-CizoHJPb.js";class x extends p{constructor(){super(...arguments);e(this,"id",g());e(this,"onDisposed",new w);e(this,"_enabled",!1);e(this,"_isDrawing",!1);e(this,"_svgViewport",null);e(this,"start",t=>null);e(this,"draw",t=>{});e(this,"end",t=>{});e(this,"cancel",t=>{t&&(t.stopImmediatePropagation(),t.key==="Escape"&&this.cancel(t))})}set svgViewport(t){this._svgViewport=t}get svgViewport(){return this._svgViewport??void 0}set enabled(t){if(this._enabled=t,this.setupEvents(t),this.components.uiEnabled){const i=this.uiElement.get("main");i.active=t}}get enabled(){return this._enabled}get canDraw(){return this.enabled&&this._svgViewport}get(){return null}async dispose(){this._svgViewport&&this._svgViewport.remove(),this.setupEvents(!1),this.uiElement.dispose(),await this.onDisposed.trigger(),this.onDisposed.reset()}setupEvents(t){if(t){if(document.addEventListener("keydown",this.cancel),!this._svgViewport)return;this._svgViewport.addEventListener("mousemove",this.draw),this._svgViewport.addEventListener("mousedown",this.start),this._svgViewport.addEventListener("mouseup",this.end)}else{if(document.removeEventListener("keydown",this.cancel),!this._svgViewport)return;this._svgViewport.removeEventListener("mousemove",this.draw),this._svgViewport.removeEventListener("mousedown",this.start),this._svgViewport.removeEventListener("mouseup",this.end)}}}class I extends p{constructor(t){super(t);e(this,"uiElement",new u);e(this,"isSetup",!1);e(this,"id",g().toLowerCase());e(this,"_enabled",!1);e(this,"onDisposed",new w);e(this,"_viewport",document.createElementNS("http://www.w3.org/2000/svg","svg"));e(this,"_size",new l);e(this,"_undoList",[]);e(this,"config",{fillColor:"transparent",strokeColor:"#BCF124",strokeWidth:4});e(this,"onSetup",new w);e(this,"onResize",()=>{this.resize()});this._viewport.classList.add("absolute","top-0","right-0"),this._viewport.setAttribute("width","100%"),this._viewport.setAttribute("height","100%"),t.uiEnabled&&this.setUI(),this.enabled=!1,this.components.ui.viewerContainer.append(this._viewport),this.setupEvents(!0)}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this.resize(),this._undoList=[],this.components.uiEnabled&&(this.uiElement.get("toolbar").visible=t),t?this._viewport.classList.remove("pointer-events-none"):(this.clear(),this.uiElement.get("settingsWindow").visible=!1,this._viewport.classList.add("pointer-events-none"))}async setup(t){this.config={...this.config,...t},this.isSetup=!0,await this.onSetup.trigger(this)}async dispose(){this._undoList=[],await this.uiElement.dispose(),await this.onDisposed.trigger(),this.onDisposed.reset()}get(){return this._viewport}clear(){const t=this.get();for(this._undoList=[];t.firstChild;)t.removeChild(t.firstChild)}getDrawing(){return this.get().childNodes}resize(){const i=this.components.renderer.getSize(),n=this.enabled?i.x:0,s=this.enabled?i.y:0;this._size.set(n,s)}getSize(){return this._size}setupEvents(t){t?window.addEventListener("resize",this.onResize):window.removeEventListener("resize",this.onResize)}setUI(){const t=new d(this.components,{materialIconName:"undo"});t.onClick.add(()=>{this._viewport.lastChild&&(this._undoList.push(this._viewport.lastChild),this._viewport.lastChild.remove())});const i=new d(this.components,{materialIconName:"redo"});i.onClick.add(()=>{const c=this._undoList[this._undoList.length-1];c&&(this._undoList.pop(),this._viewport.append(c))});const n=new d(this.components,{materialIconName:"delete"});n.onClick.add(()=>this.clear());const s=new T(this.components,this.id);s.title="Drawing Settings",s.visible=!1,this.components.ui.add(s);const r=new V(this.components);r.label="Stroke Width",r.min=2,r.max=6,r.value=4,r.onChange.add(c=>{this.config.strokeWidth=c});const m=new y(this.components);m.label="Stroke Color",m.value=this.config.strokeColor,m.onChange.add(c=>{this.config.strokeColor=c});const v=new y(this.components);v.label="Fill Color",v.value=this.config.fillColor,v.onChange.add(c=>{this.config.fillColor=c}),s.addChild(m,v,r);const E=new d(this.components,{materialIconName:"settings"});E.onClick.add(()=>{s.visible=!s.visible,E.active=s.visible}),s.onHidden.add(()=>E.active=!1);const S=new C(this.components,{position:"top"});S.addChild(E,t,i,n),this.uiElement.set({toolbar:S,settingsWindow:s})}}class b extends p{constructor(t,i,n){super(t);e(this,"name","SVGRectangle");e(this,"enabled",!0);e(this,"id",g());e(this,"onDisposed",new w);e(this,"_line",document.createElementNS("http://www.w3.org/2000/svg","line"));e(this,"_polygon",document.createElementNS("http://www.w3.org/2000/svg","polygon"));e(this,"_marker",document.createElementNS("http://www.w3.org/2000/svg","marker"));e(this,"_arrow",document.createElementNS("http://www.w3.org/2000/svg","g"));e(this,"_startPoint",new l);e(this,"_endPoint",new l);this._marker.setAttribute("id",`${this.id}-arrowhead`),this._marker.setAttribute("markerWidth","5"),this._marker.setAttribute("markerHeight","6"),this._marker.setAttribute("refX","4"),this._marker.setAttribute("refY","3"),this._marker.setAttribute("orient","auto"),this._polygon.setAttribute("points","0 0, 5 3, 0 6"),this._marker.appendChild(this._polygon),this._line.setAttribute("marker-end",`url(#${this.id}-arrowhead)`),this._arrow.append(this._marker,this._line),this.startPoint=i??this.startPoint,this.endPoint=n??this.endPoint,this._arrow.id=this.id,this.setStyle()}async dispose(){this._arrow.remove(),this._marker.remove(),this._polygon.remove(),this._line.remove(),this.components=null,await this.onDisposed.trigger(),this.onDisposed.reset()}setStyle(t){var i;this._line.setAttribute("stroke",(t==null?void 0:t.strokeColor)??"red"),this._line.setAttribute("stroke-width",((i=t==null?void 0:t.strokeWidth)==null?void 0:i.toString())??"4"),this._polygon.setAttribute("fill",(t==null?void 0:t.strokeColor)??"red")}reset(){this.x1=0,this.y1=0,this.x2=0,this.y2=0}clone(){return new b(this.components,this.startPoint,this.endPoint)}set x1(t){this._startPoint.x=t,this._line.setAttribute("x1",t.toString())}set y1(t){this._startPoint.y=t,this._line.setAttribute("y1",t.toString())}set startPoint(t){this.x1=t.x,this.y1=t.y}get startPoint(){return this._startPoint}set x2(t){this._endPoint.x=t,this._line.setAttribute("x2",t.toString())}set y2(t){this._endPoint.y=t,this._line.setAttribute("y2",t.toString())}set endPoint(t){this.x2=t.x,this.y2=t.y}get endPoint(){return this._endPoint}get(){return this._arrow}}const _=class _ extends p{constructor(t){super(t);e(this,"name","DrawManager");e(this,"onDisposed",new w);e(this,"uiElement",new u);e(this,"viewport");e(this,"drawingTools",{});e(this,"drawings",{});e(this,"_enabled",!1);e(this,"_isDrawing",!1);t.tools.add(_.uuid,this),this.viewport=new I(t),t.uiEnabled&&this.setUI(),this.enabled=!1}get isDrawing(){return this._isDrawing}set isDrawing(t){this._isDrawing=t}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this.components.uiEnabled&&(this.uiElement.get("main").active=t,this.uiElement.get("drawingTools").visible=t),this.viewport.enabled=t}async dispose(){this.uiElement.dispose(),await this.viewport.dispose();for(const t in this.drawings)this.drawings[t].remove();this.drawings={},this.components=null,await this.onDisposed.trigger(_.uuid),this.onDisposed.reset()}saveDrawing(t){const i=this.drawings[t];i==null||i.childNodes.forEach(r=>i.removeChild(r));const n=this.viewport.getDrawing(),s=i??document.createElementNS("http://www.w3.org/2000/svg","g");return s.id=t,s.append(...n),this.viewport.get().append(s),this.drawings[t]=s,s}addDrawingTool(t,i){if(!this.drawingTools[t]){if(this.components.uiEnabled){const s=i.uiElement.get("main");this.uiElement.get("drawingTools").addChild(s)}i.svgViewport=this.viewport.get(),this.drawingTools[t]=i}}activateTool(t){const i=Object.values(this.drawingTools);if(!i.find(s=>s===t)){console.warn("DrawManager: Tried to activate a drawing tool that is not registered yet.");return}for(const s of i)s.enabled=!1;t.enabled=!0}get activeTool(){return Object.values(this.drawingTools).find(i=>i.enabled===!0)}setUI(){const t=this.viewport.uiElement.get("toolbar"),i=new C(this.components,{position:"top"});setTimeout(()=>{i.visible=!1,t.visible=!1},.001),this.components.ui.addToolbar(i),this.components.ui.addToolbar(t);const n=new d(this.components);n.materialIcon="gesture",n.onClick.add(()=>this.enabled=!this.enabled),this.uiElement.set({drawingTools:i,main:n})}get(){return null}};e(_,"uuid","4ab8b0f4-665d-4ea2-8f6e-66c98ed04392");let a=_;class U extends x{constructor(t){super(t);e(this,"name","ArrowAnnotation");e(this,"canvas",null);e(this,"uiElement",new u);e(this,"_previewElement");e(this,"cancel",()=>{this._isDrawing&&(this._isDrawing=!1,this._previewElement.reset(),this._previewElement.get().remove())});e(this,"start",t=>{var n,s;if(!this.canDraw)return null;const i=this.components.tools.get(a);if(!this._isDrawing)this._isDrawing=!0,this._previewElement.setStyle(i.viewport.config),this._previewElement.x1=t.clientX,this._previewElement.y1=t.clientY,this._previewElement.x2=t.clientX,this._previewElement.y2=t.clientY,(n=this.svgViewport)==null||n.append(this._previewElement.get());else{const r=this._previewElement.clone();return r.setStyle(i.viewport.config),(s=this.svgViewport)==null||s.append(r.get()),this.cancel(),r}return null});e(this,"draw",t=>{!this.canDraw||!this._isDrawing||(this._previewElement.x1=t.clientX,this._previewElement.y1=t.clientY)});this._previewElement=new b(t);const i=this.components.tools.get(a);t.uiEnabled&&this.setUI(),i.addDrawingTool(this.name,this)}setUI(){const t=this.components.tools.get(a),i=new d(this.components);i.label="Arrow",i.materialIcon="north_east",i.onClick.add(()=>{t.activateTool(this)}),this.uiElement.set({main:i})}async dispose(){await super.dispose(),this._previewElement.dispose()}}class f extends p{constructor(t,i,n){super(t);e(this,"id",g());e(this,"name","SVGRectangle");e(this,"enabled",!0);e(this,"onDisposed",new w);e(this,"_circle",document.createElementNS("http://www.w3.org/2000/svg","circle"));e(this,"_centerPoint",new l);e(this,"_radius",20);this.centerPoint=i??this.centerPoint,this.radius=n??this.radius,this._circle.id=this.id,this.setStyle()}async dispose(){this._circle.remove(),this.components=null,await this.onDisposed.trigger(),this.onDisposed.reset()}setStyle(t){var i;this._circle.setAttribute("stroke",(t==null?void 0:t.strokeColor)??"red"),this._circle.setAttribute("stroke-width",((i=t==null?void 0:t.strokeWidth)==null?void 0:i.toString())??"4"),this._circle.setAttribute("fill",(t==null?void 0:t.fillColor)??"transparent")}reset(){this.cx=0,this.cy=0,this.radius=0}clone(){return new f(this.components,this.centerPoint,this.radius)}set radius(t){this._radius=t,this._circle.setAttribute("r",t.toString())}get radius(){return this._radius}set cx(t){this._centerPoint.x=t,this._circle.setAttribute("cx",t.toString())}set cy(t){this._centerPoint.y=t,this._circle.setAttribute("cy",t.toString())}set centerPoint(t){this.cx=t.x,this.cy=t.y}get centerPoint(){return this._centerPoint}get(){return this._circle}}class z extends x{constructor(t){super(t);e(this,"name","CircleAnnotation");e(this,"canvas",null);e(this,"uiElement",new u);e(this,"_previewElement");e(this,"_cursorPosition",new l);e(this,"start",t=>{var n,s;if(!this.canDraw)return null;const i=this.components.tools.get(a);if(!this._isDrawing)this._isDrawing=!0,this._previewElement.setStyle(i.viewport.config),this._previewElement.cx=t.clientX,this._previewElement.cy=t.clientY,(n=this.svgViewport)==null||n.append(this._previewElement.get());else{const r=this._previewElement.clone();return r.setStyle(i.viewport.config),(s=this.svgViewport)==null||s.append(r.get()),this.cancel(),r}return null});e(this,"cancel",()=>{this._isDrawing&&(this._isDrawing=!1,this._previewElement.reset(),this._previewElement.get().remove())});e(this,"draw",t=>{!this.canDraw||!this._isDrawing||(this._cursorPosition.x=t.clientX,this._cursorPosition.y=t.clientY,this._previewElement.radius=this._cursorPosition.distanceTo(this._previewElement.centerPoint))});this._previewElement=new f(t);const i=this.components.tools.get(a);t.uiEnabled&&this.setUI(),i.addDrawingTool("circle_annotation",this)}setUI(){const t=this.components.tools.get(a),i=new d(this.components);i.label="Circle",i.materialIcon="radio_button_unchecked",i.onClick.add(()=>{t.activateTool(this)}),this.uiElement.set({main:i})}async dispose(){await super.dispose(),this._previewElement.dispose()}}class P extends p{constructor(t,i,n){super(t);e(this,"id",g());e(this,"name","SVGRectangle");e(this,"enabled",!0);e(this,"onDisposed",new w);e(this,"_startPoint",new l);e(this,"_text",document.createElementNS("http://www.w3.org/2000/svg","text"));this._text.setAttribute("fill","red"),this._text.classList.add("text-2xl","font-medium"),this.text=i??"",this.startPoint=n??this.startPoint,this._text.id=this.id}async dispose(){this._text.remove(),await this.onDisposed.trigger(),this.onDisposed.reset()}setStyle(t){this._text.setAttribute("fill",(t==null?void 0:t.strokeColor)??"red")}set text(t){this._text.textContent=t}get text(){return this._text.textContent??""}reset(){this.x=0,this.y=0}clone(){return new P(this.components,this.text,this.startPoint)}set x(t){this._startPoint.x=t,this._text.setAttribute("x",t.toString())}set y(t){this._startPoint.y=t,this._text.setAttribute("y",t.toString())}set startPoint(t){this.x=t.x,this.y=t.y}get startPoint(){return this._startPoint}get(){return this._text}}class M extends x{constructor(t){super(t);e(this,"name","TextAnnotation");e(this,"uiElement",new u);e(this,"canvas",null);e(this,"_previewElement");e(this,"cancel",()=>{this._isDrawing&&(this._isDrawing=!1,this._previewElement.reset(),this._previewElement.get().remove())});e(this,"start",t=>{var n,s;if(!this.canDraw)return null;const i=this.components.tools.get(a);if(this._isDrawing){const r=this._previewElement.clone();return r.setStyle(i.viewport.config),(s=this.svgViewport)==null||s.append(r.get()),this.cancel(),r}else{this._isDrawing=!0;const r=prompt("Enter your text",this._previewElement.text);if(!r)return this.cancel(),null;this._previewElement.setStyle(i.viewport.config),this._previewElement.text=r,this._previewElement.x=t.clientX,this._previewElement.y=t.clientY,(n=this.svgViewport)==null||n.append(this._previewElement.get())}return null});e(this,"draw",t=>{!this.canDraw||!this._isDrawing||(this._previewElement.x=t.clientX,this._previewElement.y=t.clientY)});this._previewElement=new P(t);const i=this.components.tools.get(a);t.uiEnabled&&this.setUI(),i.addDrawingTool(this.name,this)}setUI(){const t=this.components.tools.get(a),i=new d(this.components);i.label="Text",i.materialIcon="title",i.onClick.add(()=>{t.activateTool(this)}),this.uiElement.set({main:i})}async dispose(){await super.dispose(),await this._previewElement.dispose()}}class D extends p{constructor(t,i,n){super(t);e(this,"id",g());e(this,"name","SVGRectangle");e(this,"enabled",!0);e(this,"onDisposed",new w);e(this,"_startPoint",new l);e(this,"_endPoint",new l);e(this,"_dimensions",new l);e(this,"_rect",document.createElementNS("http://www.w3.org/2000/svg","rect"));this.startPoint=i??this.startPoint,this.endPoint=n??this.endPoint,this._rect.setAttribute("rx","5"),this._rect.id=this.id,this.setStyle()}async dispose(){this._rect.remove(),this.components=null,await this.onDisposed.trigger(),this.onDisposed.reset()}setStyle(t){var i;this._rect.setAttribute("stroke",(t==null?void 0:t.strokeColor)??"red"),this._rect.setAttribute("stroke-width",((i=t==null?void 0:t.strokeWidth)==null?void 0:i.toString())??"4"),this._rect.setAttribute("fill",(t==null?void 0:t.fillColor)??"transparent")}reset(){this.x1=0,this.y1=0,this.x2=0,this.y2=0}clone(){return new D(this.components,this.startPoint,this.endPoint)}set x1(t){this._startPoint.x=t,this._rect.setAttribute("x",t.toString())}set y1(t){this._startPoint.y=t,this._rect.setAttribute("y",t.toString())}set startPoint(t){this.x1=t.x,this.y1=t.y}get startPoint(){return this._startPoint}set x2(t){const i=t<this.startPoint.x;this._endPoint.x=i?this.startPoint.x:t,this.x1=i?t:this.startPoint.x,this._dimensions.x=this.endPoint.x-this.startPoint.x,this._rect.setAttribute("width",this._dimensions.x.toString())}set y2(t){const i=t<this.startPoint.y;this._endPoint.y=i?this.startPoint.y:t,this.y1=i?t:this.startPoint.y,this._dimensions.y=this.endPoint.y-this.startPoint.y,this._rect.setAttribute("height",this._dimensions.y.toString())}set endPoint(t){this.x2=t.x,this.y2=t.y}get endPoint(){return this._endPoint}set width(t){this.x2=this.startPoint.x+t}get width(){return this._dimensions.x}set height(t){this.y2=this.startPoint.y+t}get height(){return this._dimensions.y}set dimensions(t){this.width=t.x,this.height=t.y}get dimensions(){return this._dimensions}get(){return this._rect}}class R extends x{constructor(t){super(t);e(this,"name","RectangleAnnotation");e(this,"canvas",null);e(this,"uiElement",new u);e(this,"_previewElement");e(this,"_startPoint",new l);e(this,"start",t=>{var n,s;if(!this.canDraw)return null;const i=this.components.tools.get(a);if(!this._isDrawing)this._isDrawing=!0,this._previewElement.setStyle(i.viewport.config),this._startPoint.set(t.clientX,t.clientY),(n=this.svgViewport)==null||n.append(this._previewElement.get());else{const r=this._previewElement.clone();return r.setStyle(i.viewport.config),(s=this.svgViewport)==null||s.append(r.get()),this.cancel(),r}return null});e(this,"cancel",()=>{this._isDrawing&&(this._isDrawing=!1,this._startPoint.x=0,this._startPoint.y=0,this._previewElement.reset(),this._previewElement.get().remove())});e(this,"draw",t=>{!this.canDraw||!this._isDrawing||(this._previewElement.x1=this._startPoint.x,this._previewElement.y1=this._startPoint.y,this._previewElement.x2=t.clientX,this._previewElement.y2=t.clientY)});this._previewElement=new D(t);const i=this.components.tools.get(a);t.uiEnabled&&this.setUI(),i.addDrawingTool(this.name,this)}setUI(){const t=this.components.tools.get(a),i=new d(this.components);i.label="Rectangle",i.materialIcon="crop_square",i.onClick.add(()=>{t.activateTool(this)}),this.uiElement.set({main:i})}async dispose(){await super.dispose(),this._previewElement.dispose()}}export{U as A,x as B,z as C,a as D,R,I as S,M as T};
