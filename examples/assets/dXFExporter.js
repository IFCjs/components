import{C as U,S as k,P as B,a as P,b as v,c as j,e as y,g as D,F as O,E as R,L as b,i as m,p as T,q as I,r as N,T as W,s as X}from"./index-DOCiYP8C.js";import{S as q}from"./stats.min-B_nWG6JV.js";const f=document.getElementById("container"),e=new U,E=new k(e);E.setup();e.scene=E;const i=new B(e,f);e.renderer=i;const C=new P(e);e.camera=C;C.controls.setLookAt(12,6,8,0,0,-10);e.raycaster=new v(e);e.init();const{postproduction:l}=i;l.enabled=!0;const p=new j(e,new y(6710886)),G=p.get();l.customEffects.excludedMeshes.push(G);const c=new D(e),M=new O(e);f.addEventListener("mouseup",()=>c.elements.needsUpdate=!0);f.addEventListener("wheel",()=>c.elements.needsUpdate=!0);const V=await fetch("../../../resources/small.frag"),$=await V.arrayBuffer(),z=new Uint8Array($),a=await M.load(z);for(const t of a.items)c.elements.add(t.mesh);const H=await fetch("../../../resources/small.json");a.setLocalProperties(await H.json());c.elements.needsUpdate=!0;const w=new R(e),J=new b({color:"black"}),K=new b({color:"blue"}),Q=new m({color:"gray",side:2}),Y=new m({color:"black",side:1,opacity:.5,transparent:!0});w.styles.create("projected",new Set,K);w.styles.create("filled",new Set,J,Q,Y);const d=w.styles.get();l.customEffects.outlineEnabled=!0;const u=new T(e);u.byEntity(a);const h=u.find({entities:["IFCWALLSTANDARDCASE","IFCWALL"]});for(const t in h){const{mesh:s}=M.list[t];d.filled.fragments[t]=new Set(h[t]),d.filled.meshes.add(s)}const S=[];for(const t of a.items){const{mesh:s}=t;S.push(s),d.projected.meshes.add(s)}const L=new y("white"),Z=new m({color:L}),n=new I(e);n.addMaterial("white",Z);n.addMeshes("white",S);const o=new N(e);await o.computeAllPlanViews(a);u.byStorey(a);const F=new W(e);e.ui.addToolbar(F);F.addChild(o.uiElement.get("main"));o.onNavigated.add(()=>{l.customEffects.glossEnabled=!1,n.setBackgroundColor(L),n.set(!0,["white"]),p.visible=!1});o.onExited.add(()=>{l.customEffects.glossEnabled=!0,n.resetBackgroundColor(),n.set(!1,["white"]),p.visible=!0});const _=new X(e);o.commands={"Export to DXF":async t=>{if(!t)return;const s=document.createElement("a"),x=await _.export(t.name),g=`${t.name}.dxf`,A=new File([new Blob([x])],g);s.href=URL.createObjectURL(A),s.download=g,s.click(),s.remove()}};await o.updatePlansList();for(const{mesh:t}of a.items)t.material[0].opacity!==1&&(t.material[0].depthWrite=!1,t.material[0].polygonOffset=!0,t.material[0].polygonOffsetFactor=5,t.material[0].polygonOffsetUnits=1);const r=new q;r.showPanel(2);document.body.append(r.dom);r.dom.style.left="0px";r.dom.style.right="auto";i.onBeforeUpdate.add(()=>r.begin());i.onAfterUpdate.add(()=>r.end());
